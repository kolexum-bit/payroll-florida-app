{% extends "base.html" %}
{% block title %}Monthly Payroll{% endblock %}
{% block content %}
<h1>Monthly Payroll</h1>
{% if message %}<div class="message {{ status }}">{{ message }}</div>{% endif %}

<form method="post" action="/monthly-payroll">
  {% if edit_entry %}<input type="hidden" name="payroll_id" value="{{ edit_entry.id }}" />{% endif %}
  <div><label>Employee</label><br />
    <select name="employee_id" required>
      {% for employee in employees %}
      <option value="{{ employee.id }}" {% if edit_entry and edit_entry.employee_id == employee.id %}selected{% endif %}>{{ employee.first_name }} {{ employee.last_name }}</option>
      {% endfor %}
    </select>
  </div>
  <div><label>Period (YYYY-MM)</label><br /><input type="text" name="period" required value="{{ edit_entry.period if edit_entry else '' }}" /></div>
  <div><label>Gross Pay</label><br /><input type="number" step="0.01" name="gross_pay" required value="{{ edit_entry.gross_pay if edit_entry else '' }}" /></div>
  <button type="submit">{{ "Update Payroll" if edit_entry else "Create Payroll" }}</button>
</form>

<table>
<thead><tr><th>ID</th><th>Employee</th><th>Period</th><th>Gross</th><th>Net</th><th>Actions</th></tr></thead>
<tbody>
{% for entry in entries %}
<tr>
  <td>{{ entry.id }}</td>
  <td>{{ entry.employee.first_name }} {{ entry.employee.last_name }}</td>
  <td>{{ entry.period }}</td>
  <td>{{ entry.gross_pay }}</td>
  <td>{{ entry.net_pay }}</td>
  <td class="actions">
    <a href="/monthly-payroll?edit_id={{ entry.id }}">Edit</a>
    <form method="post" action="/monthly-payroll/{{ entry.id }}/delete"><button type="submit">Delete</button></form>
  </td>
</tr>
{% else %}<tr><td colspan="6">No payroll entries yet.</td></tr>{% endfor %}
</tbody>
</table>
{% endblock %}
